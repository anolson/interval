<% @primary_heading= link_to content_tag(:h1, "Pricing and Sign Up"), :action => "index" %>

<div id="signup" class="container complete">

<div class="container full">
  <table id="plans" width="100%" cellspacing=0>
    
    <tr>
      <th class="noborder"></th>
      <% @plans.each do |plan| %>
        <% if plan.eql?(@current_plan) %>
        <th class="noborder"> 
          <span class="light">Your current plan</span><br/>
          <span style="font-size:25px; padding:0px; margin:0px" class="lighter">â€¢</span>
        </th>
        <% else %>
        <th class="noborder"></th>
        <% end %>
      <% end %>
    </tr>
    
    <tr>
      <th class="noborder"></th>
      <% @plans.each do |plan| %>
        <th class="plan <%= plan.eql?(@current_plan) && 'current' %>"><%= plan.name %></th>
      <% end %>
    </tr>
    <tr>
      <td class="feature">Price</td>
      <% @plans.each do |plan| %>
        <td class="plan <%= plan.eql?(@current_plan) && 'current' %>">
          <% if plan.paid? %>
            $<%= (plan.price/100).round %>/month <br />
            <span class="small lighter">Includes a 30-day trial.</span>
          <% else  %>
            Free
          <% end %>
        </td>
      <% end %>
    </tr>

    <tr>
      <td class="feature">Workouts</td>
      <% @plans.each do |plan| %>
        <td class="plan <%= plan.eql?(@current_plan) && 'current' %>">
          <% if plan.has_workout_limit? %>
            <% if plan.paid? %>
              <%= plan.workout_limit %>/<%= plan.limit_by %> <br />
            <% else %>
              <%= plan.workout_limit %> <br />
            <% end %>
            
          <% else  %>
            Unlimited
          <% end %>
        </td>
      <% end %>
    </tr>


    <tr>
      <td class="feature">File Storage</td>
      <% @plans.each do |plan| %>
        <td class="plan <%= plan.eql?(@current_plan) && 'current' %>">
          <%= number_to_human_size(plan.storage_limit) %>
        </td>
      <% end %>
    </tr>

    <% %w{workout_graphs training_summaries peak_power_analysis sharing}.each do |feature|%>
      <tr>
        <td class="feature"><%=feature.titleize%></td>
        <% @plans.each do |plan| %>
          <td class="plan check <%= plan.eql?(@current_plan) && 'current' %>">&nbsp;</td>
        <% end %>
      </tr>
    <% end %>


    <tr>
      <td class="feature"></td>
      <% @plans.each do |plan| %>
        <td class="plan <%= plan.eql?(@current_plan) && 'current' %>">
          
          <% if @current_plan %>
            <% unless plan.eql?(@current_plan) %>
              <% if Subscription.is_within_limits?(@user, plan) %>

                <% if plan.price < @current_plan.price %>
                  <%= link_to "Downgrade to #{plan.name}", 
                    :controller => 'user', 
                    :action => 'update_plan', 
                    :plan => "#{plan.name.downcase}" %>
                <% else %>
                  <%= link_to "Upgrade to #{plan.name}", 
                    :controller => 'user', 
                    :action => 'update_plan', 
                    :plan => "#{plan.name.downcase}" %>
                <% end %>
              <% end %>
              
            <% end %>
          <% else %>
            <%= link_to "Sign-up for #{plan.name}", :controller => 'user', :action => 'signup', :plan => "#{plan.name.downcase}" %>
          <% end %>
        </td>
      <% end %>
    </tr>
    
  </table>
</div>

  <div class="container half">
   <br/>
   <h3>How does the 30-day free trial work?</h3>
   <p class="large">  
    When you sign-up for a paid plan, a 30-day free trial is included.  If you cancel before the 30 days is up, you won't be charged.       
    The 30-day free trail is not available if you upgrade from the free plan. 
   </p>
   <h3>Is there a commitment?</h3>
   <p class="large">  
    No. Interval charges monthly.  Cancel at anytime. There are no sign-up fees, no long term contracts, and no cancelation fees.  
   </p>
   <h3>Change your plan at anytime.</h3>
   <p class="large">  
    Upgrade, downgrade, or cancel at anytime. There are no extra fees.  The new charge will take effect on your next billing cycle.   
    If you cancel, you won't be charged again.  We do not prorate partial months and cannot issues refunds.
   </p>
  </div>

</div>

