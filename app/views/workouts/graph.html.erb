<% @primary_heading = content_tag(:h1, link_to( @workout.name, :action => "show"), :id => "workout_name_#{@workout.id}" ) %>
<% @editable = @sharing ? false : true %>
<% @secondary_heading = content_tag :span, nice_datetime(@workout.performed_on), :class => "larger", :id => "workout_date_#{@workout.id}" %>

<% @secondary_links = [
  { :text => 'Summary', :options => {:controller => 'workouts', :action => 'show', :id => @workout.id } }, 
  { :text => 'Graph', :options => {:controller => 'workouts', :action => 'graph', :id => @workout.id } }, 
  { :text => 'Peak Power', :options => {:controller => 'peak', :action => 'show', :id => @workout.id } } ] %>
  
<% if @sharing %>
  <% @secondary_links.each {|l| l[:options].merge!({:user => @user.username})}  %>
<% end %>

<div id="main">
  <% rounded_box nil, "complete", "full" do %> 

  <div class="zoom">   
    <a href="#" id='zoom_reset' class='small' onClick="return false;">Zoom Out</a>&nbsp;
  </div>
    <% container "full" do %>
      <div id="plot" class="plot" style="height:400px;">
        <div id="loader" style="padding-top: 150px; text-align:center">
        <%= image_tag("loader.gif") %><br/>
        Loading graph.</div>
      </div>
      <div id="graph_summary">      
        <table border="0" cellspacing="0" cellpadding="3" id="graph_labels">
          <tr>
            <td align="right">Time :</td><td><span id="selected_time">00:00:00</span></td>
          </tr>
        </table>
      </div>
      <div class="smaller right">Note: Click and drag to see more detail.</div>    
    <% end %>
  <% end %>
  <%= render :partial => 'common/back' %>
</div>
<%= javascript_include_tag('flotr/flotr-0.1.0alpha', 'graph') %>

<script type="text/javascript">
  document.observe('dom:loaded', function(){
    Element.hide('zoom_reset');
    var url = "<%= "/workouts/show/#{@workout.id}.json?power=true&heartrate=true" %>";
    //var url = '<%= url_for(:action => 'show', :id => @workout.id, :format => 'json', :power => 'true', :heartrate => 'true') %>'
    new Ajax.Request(url, {
   		method:'get',
   		onSuccess: function(transport){
   			var json = transport.responseText.evalJSON();
   			data_series = json.data_series
   			time_series = json.time_series

   			if(data_series){
   				$('plot').setStyle({'display':'block'});
           var f = drawPlot(data_series);
         }
   		}
   	});
  });
</script>