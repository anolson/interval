<% data_series = Array.new %>
<%    
   #raise params[:power].to_s
   #@include.each { |incl|
    if params[:power]
      data_series << {
        :data => @data_points.collect_with_index do |v, i| [i, v.power] end, 
        :label => 'Power'}
    end
    if params[:heartrate]
      data_series << {
        :data => @data_points.collect_with_index do |v, i| [i, v.heartrate] end, 
        :label => 'Heartrate'}
    end
    if params[:cadence]
      data_series << {
        :data => @data_points.collect_with_index do |v, i| [i, v.cadence] end, 
        :label => 'Cadence'}
    end
  #}
  
%>

<% series = {
  :data_series => data_series,
  :time_series => [
    {:data => 
      @data_points.collect_with_index do |value, index| [index, nice_duration(Time.at(value.relative_time).utc)] end } || []
  ]
}
%>
<%= series.to_json %>